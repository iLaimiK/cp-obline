import{E as e,q as a,W as l,b as s,o,a as t,w as u,z as n,i as r,d as i,e as c,t as d,k as m,h as p,D as f,l as v}from"./index-SNMhby7L.js";import{_}from"./uni-easyinput.Sk3ZZ7wt.js";import{r as b}from"./uni-app.es.CqodLWiA.js";import{_ as k,a as h}from"./uni-forms.DO5j5MHi.js";import{_ as g}from"./uni-countdown.OwkuUEEk.js";import{u as y}from"./http.CqkQg3YM.js";import{Q as w,v as C,c as j}from"./user.CMNANS_S.js";import{_ as q}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.GkTfaCN8.js";const V=q({__name:"qq",setup(q){const V=y(),x=e();let M="",I=x[x.length-1].$page.fullPath.match(/access_token=([^&]*)/);I&&(M=I[1]);const T=a({}),A=a(!0);l.callFunction({name:"qq-connect",data:{access_token:M},success:async e=>{T.value=e.result;const a=await w({openId:e.result.openid,source:"qq"});10001===a.code?A.value=a.data.bindingFlag:L(a.data)},fail:e=>{console.log(e)}});const F=a("获取验证码"),Q=a(),U=a({mobile:"13212345678",code:""});a({mobile:{rules:[{required:!0,errorMessage:"请输入手机号"},{pattern:"^(?:(?:\\+|00)86)?1(?:(?:3[\\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\\d])|(?:9[1589]))\\d{8}$",errorMessage:"手机号格式不正确"}]},code:{rules:[{required:!0,errorMessage:"请输入验证码"},{pattern:"^\\d{6}$",errorMessage:"验证码格式不正确"}]}});const $=a(!1),z=a(!1),B=e=>{$.value=!$.value},D=async()=>{await Q.value.validateField(["mobile"]);const e=await C({mobile:U.value.mobile,type:"bindMobile"});if(1e4!==e.code)return uni.utils.toast(e.message);uni.utils.toast("验证码已发送"),z.value=!0,console.log(e)},E=()=>{z.value=!1,F.value="重新获取"},H=async()=>{if(!$.value)return uni.utils.toast("请同意协议！");try{await Q.value.validate();const e=await j({...U.value,openId:T.value.openid});if(1e4!==e.code)return uni.utils.toast(e.message);L(e.data)}catch(e){console.log(e)}},L=e=>{V.token=e.token,V.refreshToken=e.refreshToken,V.userId=e.id,uni[V.openType]({url:V.redirectURL})};return(e,a)=>{const l=m,y=p,w=r,C=b(s("uni-easyinput"),_),j=b(s("uni-forms-item"),k),q=b(s("uni-countdown"),g),V=f,x=v,M=b(s("uni-forms"),h);return A.value?n("",!0):(o(),t(w,{key:0,class:"user-login"},{default:u((()=>[i(w,{class:"welcome"},{default:u((()=>[i(l,{class:"avatar",src:T.value.avatar},null,8,["src"]),i(y,{class:"nickname"},{default:u((()=>[c(" Hi，"+d(T.value.nickname)+" 欢迎来优医咨询，完成绑定后可以QQ账号一键登录哦~ ",1)])),_:1})])),_:1}),i(M,{class:"login-form",ref_key:"form",ref:Q},{default:u((()=>[i(j,{name:"mobile"},{default:u((()=>[i(C,{modelValue:U.value.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>U.value.mobile=e),"input-border":!1,clearable:!1,placeholder:"请输入手机号","placeholder-style":"color: #C3C3C5"},null,8,["modelValue"])])),_:1}),i(j,{name:"code"},{default:u((()=>[i(C,{modelValue:U.value.code,"onUpdate:modelValue":a[1]||(a[1]=e=>U.value.code=e),"input-border":!1,clearable:!1,placeholder:"请输入验证码","placeholder-style":"color: #C3C3C5"},null,8,["modelValue"]),z.value?(o(),t(w,{key:0,class:"text-button"},{default:u((()=>[i(q,{"show-day":!1,"show-hour":!1,"show-minute":!1,second:10,onTimeup:E,color:"#16C2A3"}),c("秒后重试 ")])),_:1})):(o(),t(y,{key:1,onClick:D,class:"text-button"},{default:u((()=>[c(d(F.value),1)])),_:1}))])),_:1}),i(w,{class:"agreement"},{default:u((()=>[i(V,{onClick:B,checked:$.value,color:"#16C2A3"},null,8,["checked"]),c(" 我已同意 "),i(y,{class:"link"},{default:u((()=>[c("用户协议")])),_:1}),c(" 及 "),i(y,{class:"link"},{default:u((()=>[c("隐私协议")])),_:1})])),_:1}),i(x,{onClick:H,class:"uni-button"},{default:u((()=>[c("绑定手机号")])),_:1}),i(x,{class:"uni-button secondary"},{default:u((()=>[c("暂不绑定")])),_:1})])),_:1},512)])),_:1}))}}},[["__scopeId","data-v-e428cdeb"]]);export{V as default};

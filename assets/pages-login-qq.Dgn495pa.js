import{H as e,q as a,W as l,D as s,E as o,b as t,o as u,a as n,w as r,z as c,i,d,e as m,t as p,k as f,h as v,G as _,l as b}from"./index-DZYRYWK8.js";import{_ as h}from"./uni-easyinput.lzo-b6EX.js";import{r as k}from"./uni-app.es.DbCdGPBd.js";import{_ as g,a as y}from"./uni-forms.E3BRzDjV.js";import{_ as w}from"./uni-countdown.D2TMgU8R.js";import{u as C}from"./http.BtQMKx8L.js";import{Q as j,v as q,c as V}from"./user.mxfBgdu1.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.DjJVVxUr.js";const M=x({__name:"qq",setup(x){const M=C(),T=e();let I="",U=T[T.length-1].$page.fullPath.match(/access_token=([^&]*)/);U&&(I=U[1]);const A=a({}),F=a(!0);l.callFunction({name:"qq-connect",data:{access_token:I},success:async e=>{A.value=e.result;const a=await j({openId:e.result.openid,source:"qq"});10001===a.code?F.value=a.data.bindingFlag:G(a.data)},fail:e=>{console.log(e)}});const Q=a("获取验证码"),$=a(),z=a({mobile:"13212345678",code:""});a({mobile:{rules:[{required:!0,errorMessage:"请输入手机号"},{pattern:"^(?:(?:\\+|00)86)?1(?:(?:3[\\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\\d])|(?:9[1589]))\\d{8}$",errorMessage:"手机号格式不正确"}]},code:{rules:[{required:!0,errorMessage:"请输入验证码"},{pattern:"^\\d{6}$",errorMessage:"验证码格式不正确"}]}});const H=a(!1),L=a(!1),R=e=>{H.value=!H.value},B=async()=>{await $.value.validateField(["mobile"]);const e=await q({mobile:z.value.mobile,type:"bindMobile"});if(1e4!==e.code)return uni.utils.toast(e.message);uni.utils.toast("验证码已发送"),L.value=!0,console.log(e)},D=()=>{L.value=!1,Q.value="重新获取"},E=async()=>{if(!H.value)return uni.utils.toast("请同意协议！");try{await $.value.validate();const e=await V({...z.value,openId:A.value.openid});if(1e4!==e.code)return uni.utils.toast(e.message);G(e.data)}catch(e){console.log(e)}},G=e=>{M.token=e.token,M.refreshToken=e.refreshToken,M.userId=e.id,"switchTab"===M.openType?s({url:M.redirectURL}):o({url:M.redirectURL})};return(e,a)=>{const l=f,s=v,o=i,C=k(t("uni-easyinput"),h),j=k(t("uni-forms-item"),g),q=k(t("uni-countdown"),w),V=_,x=b,M=k(t("uni-forms"),y);return F.value?c("",!0):(u(),n(o,{key:0,class:"user-login"},{default:r((()=>[d(o,{class:"welcome"},{default:r((()=>[d(l,{class:"avatar",src:A.value.avatar},null,8,["src"]),d(s,{class:"nickname"},{default:r((()=>[m(" Hi，"+p(A.value.nickname)+" 欢迎来优医咨询，完成绑定后可以QQ账号一键登录哦~ ",1)])),_:1})])),_:1}),d(M,{class:"login-form",ref_key:"form",ref:$},{default:r((()=>[d(j,{name:"mobile"},{default:r((()=>[d(C,{modelValue:z.value.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>z.value.mobile=e),"input-border":!1,clearable:!1,placeholder:"请输入手机号","placeholder-style":"color: #C3C3C5"},null,8,["modelValue"])])),_:1}),d(j,{name:"code"},{default:r((()=>[d(C,{modelValue:z.value.code,"onUpdate:modelValue":a[1]||(a[1]=e=>z.value.code=e),"input-border":!1,clearable:!1,placeholder:"请输入验证码","placeholder-style":"color: #C3C3C5"},null,8,["modelValue"]),L.value?(u(),n(o,{key:0,class:"text-button"},{default:r((()=>[d(q,{"show-day":!1,"show-hour":!1,"show-minute":!1,second:10,onTimeup:D,color:"#16C2A3"}),m("秒后重试 ")])),_:1})):(u(),n(s,{key:1,onClick:B,class:"text-button"},{default:r((()=>[m(p(Q.value),1)])),_:1}))])),_:1}),d(o,{class:"agreement"},{default:r((()=>[d(V,{onClick:R,checked:H.value,color:"#16C2A3"},null,8,["checked"]),m(" 我已同意 "),d(s,{class:"link"},{default:r((()=>[m("用户协议")])),_:1}),m(" 及 "),d(s,{class:"link"},{default:r((()=>[m("隐私协议")])),_:1})])),_:1}),d(x,{onClick:E,class:"uni-button"},{default:r((()=>[m("绑定手机号")])),_:1}),d(x,{class:"uni-button secondary"},{default:r((()=>[m("暂不绑定")])),_:1})])),_:1},512)])),_:1}))}}},[["__scopeId","data-v-03cadb5d"]]);export{M as default};

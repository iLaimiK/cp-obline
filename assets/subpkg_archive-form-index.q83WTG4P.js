import{W as e,b as t,o as a,a as l,w as s,e as i,t as o,f as d,F as r,J as n,g as c,n as u,d as h,z as m,h as f,i as p,K as g,L as y,M as b,G as v,N as x,q as k,O as _,P as C,Q as D,l as S}from"./index-nfqmuTx8.js";import{_ as L}from"./uni-easyinput.Guna4PVw.js";import{r as V,o as T}from"./uni-app.es.l2AdP1v2.js";import{_ as F,a as $}from"./uni-forms.lBAMYfhL.js";import{_ as I}from"./uni-load-more.DqsB8xz1.js";import{_ as w}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as j}from"./scroll-page.E3VajpOZ.js";import{p as E,u as B,a as M}from"./patient.Dhw7jAze.js";import"./uni-icons.CVREZnA1.js";import"./http.BKV-_WDr.js";const N=w({name:"uniDataChecklist",mixins:[e.mixinDatacom||{}],emits:["input","update:modelValue","change"],props:{mode:{type:String,default:"default"},multiple:{type:Boolean,default:!1},value:{type:[Array,String,Number],default:()=>""},modelValue:{type:[Array,String,Number],default:()=>""},localdata:{type:Array,default:()=>[]},min:{type:[Number,String],default:""},max:{type:[Number,String],default:""},wrap:{type:Boolean,default:!1},icon:{type:String,default:"left"},selectedColor:{type:String,default:""},selectedTextColor:{type:String,default:""},emptyText:{type:String,default:"暂无数据"},disabled:{type:Boolean,default:!1},map:{type:Object,default:()=>({text:"text",value:"value"})}},watch:{localdata:{handler(e){this.range=e,this.dataList=this.getDataList(this.getSelectedValue(e))},deep:!0},mixinDatacomResData(e){this.range=e,this.dataList=this.getDataList(this.getSelectedValue(e))},value(e){this.dataList=this.getDataList(e)},modelValue(e){this.dataList=this.getDataList(e)}},data:()=>({dataList:[],range:[],contentText:{contentdown:"查看更多",contentrefresh:"加载中",contentnomore:"没有更多"},isLocal:!0,styles:{selectedColor:"#2979ff",selectedTextColor:"#666"},isTop:0}),computed:{dataValue(){return""===this.value?this.modelValue:(this.modelValue,this.value)}},created(){this.localdata&&0!==this.localdata.length?(this.isLocal=!0,this.range=this.localdata,this.dataList=this.getDataList(this.getSelectedValue(this.range))):this.collection&&(this.isLocal=!1,this.loadData())},methods:{loadData(){this.mixinDatacomGet().then((e=>{this.mixinDatacomResData=e.result.data,0===this.mixinDatacomResData.length?(this.isLocal=!1,this.mixinDatacomErrorMessage=this.emptyText):this.isLocal=!0})).catch((e=>{this.mixinDatacomErrorMessage=e.message}))},getForm(e="uniForms"){let t=this.$parent,a=t.$options.name;for(;a!==e;){if(t=t.$parent,!t)return!1;a=t.$options.name}return t},change(e){const t=e.detail.value;let a={value:[],data:[]};if(this.multiple)this.range.forEach((e=>{t.includes(e[this.map.value]+"")&&(a.value.push(e[this.map.value]),a.data.push(e))}));else{const e=this.range.find((e=>e[this.map.value]+""===t));e&&(a={value:e[this.map.value],data:e})}this.$emit("input",a.value),this.$emit("update:modelValue",a.value),this.$emit("change",{detail:a}),this.multiple?this.dataList=this.getDataList(a.value,!0):this.dataList=this.getDataList(a.value)},getDataList(e){let t=JSON.parse(JSON.stringify(this.range)),a=[];return this.multiple&&(Array.isArray(e)||(e=[])),t.forEach(((t,l)=>{if(t.disabled=t.disable||t.disabled||!1,this.multiple)if(e.length>0){let a=e.find((e=>e===t[this.map.value]));t.selected=void 0!==a}else t.selected=!1;else t.selected=e===t[this.map.value];a.push(t)})),this.setRange(a)},setRange(e){let t=e.filter((e=>e.selected)),a=Number(this.min)||0,l=Number(this.max)||"";return e.forEach(((s,i)=>{if(this.multiple){if(t.length<=a){void 0!==t.find((e=>e[this.map.value]===s[this.map.value]))&&(s.disabled=!0)}if(t.length>=l&&""!==l){void 0===t.find((e=>e[this.map.value]===s[this.map.value]))&&(s.disabled=!0)}}this.setStyles(s,i),e[i]=s})),e},setStyles(e,t){e.styleBackgroud=this.setStyleBackgroud(e),e.styleIcon=this.setStyleIcon(e),e.styleIconText=this.setStyleIconText(e),e.styleRightIcon=this.setStyleRightIcon(e)},getSelectedValue(e){if(!this.multiple)return this.dataValue;let t=[];return e.forEach((e=>{e.selected&&t.push(e[this.map.value])})),this.dataValue.length>0?this.dataValue:t},setStyleBackgroud(e){let t={},a=this.selectedColor?this.selectedColor:"#2979ff";this.selectedColor&&("list"!==this.mode&&(t["border-color"]=e.selected?a:"#DCDFE6"),"tag"===this.mode&&(t["background-color"]=e.selected?a:"#f5f5f5"));let l="";for(let s in t)l+=`${s}:${t[s]};`;return l},setStyleIcon(e){let t={},a="";if(this.selectedColor){let a=this.selectedColor?this.selectedColor:"#2979ff";t["background-color"]=e.selected?a:"#fff",t["border-color"]=e.selected?a:"#DCDFE6",!e.selected&&e.disabled&&(t["background-color"]="#F2F6FC",t["border-color"]=e.selected?a:"#DCDFE6")}for(let l in t)a+=`${l}:${t[l]};`;return a},setStyleIconText(e){let t={},a="";if(this.selectedColor){let a=this.selectedColor?this.selectedColor:"#2979ff";"tag"===this.mode?t.color=e.selected?this.selectedTextColor?this.selectedTextColor:"#fff":"#666":t.color=e.selected?this.selectedTextColor?this.selectedTextColor:a:"#666",!e.selected&&e.disabled&&(t.color="#999")}for(let l in t)a+=`${l}:${t[l]};`;return a},setStyleRightIcon(e){let t={},a="";"list"===this.mode&&(t["border-color"]=e.selected?this.styles.selectedColor:"#DCDFE6");for(let l in t)a+=`${l}:${t[l]};`;return a}}},[["render",function(e,k,_,C,D,S){const L=V(t("uni-load-more"),I),T=f,F=p,$=g,w=y,j=b,E=v,B=x;return a(),l(F,{class:"uni-data-checklist",style:u({"margin-top":D.isTop+"px"})},{default:s((()=>[D.isLocal?(a(),d(r,{key:1},[_.multiple?(a(),l(j,{key:0,class:n(["checklist-group",{"is-list":"list"===_.mode||_.wrap}]),onChange:S.change},{default:s((()=>[(a(!0),d(r,null,c(D.dataList,((e,t)=>(a(),l(w,{class:n(["checklist-box",["is--"+_.mode,e.selected?"is-checked":"",_.disabled||e.disabled?"is-disable":"",0!==t&&"list"===_.mode?"is-list-border":""]]),style:u(e.styleBackgroud),key:t},{default:s((()=>[h($,{class:"hidden",hidden:"",disabled:_.disabled||!!e.disabled,value:e[_.map.value]+"",checked:e.selected},null,8,["disabled","value","checked"]),"tag"!==_.mode&&"list"!==_.mode||"list"===_.mode&&"left"===_.icon?(a(),l(F,{key:0,class:"checkbox__inner",style:u(e.styleIcon)},{default:s((()=>[h(F,{class:"checkbox__inner-icon"})])),_:2},1032,["style"])):m("",!0),h(F,{class:n(["checklist-content",{"list-content":"list"===_.mode&&"left"===_.icon}])},{default:s((()=>[h(T,{class:"checklist-text",style:u(e.styleIconText)},{default:s((()=>[i(o(e[_.map.text]),1)])),_:2},1032,["style"]),"list"===_.mode&&"right"===_.icon?(a(),l(F,{key:0,class:"checkobx__list",style:u(e.styleBackgroud)},null,8,["style"])):m("",!0)])),_:2},1032,["class"])])),_:2},1032,["class","style"])))),128))])),_:1},8,["class","onChange"])):(a(),l(B,{key:1,class:n(["checklist-group",{"is-list":"list"===_.mode,"is-wrap":_.wrap}]),onChange:S.change},{default:s((()=>[(a(!0),d(r,null,c(D.dataList,((e,t)=>(a(),l(w,{class:n(["checklist-box",["is--"+_.mode,e.selected?"is-checked":"",_.disabled||e.disabled?"is-disable":"",0!==t&&"list"===_.mode?"is-list-border":""]]),style:u(e.styleBackgroud),key:t},{default:s((()=>[h(E,{class:"hidden",hidden:"",disabled:_.disabled||e.disabled,value:e[_.map.value]+"",checked:e.selected},null,8,["disabled","value","checked"]),"tag"!==_.mode&&"list"!==_.mode||"list"===_.mode&&"left"===_.icon?(a(),l(F,{key:0,class:"radio__inner",style:u(e.styleBackgroud)},{default:s((()=>[h(F,{class:"radio__inner-icon",style:u(e.styleIcon)},null,8,["style"])])),_:2},1032,["style"])):m("",!0),h(F,{class:n(["checklist-content",{"list-content":"list"===_.mode&&"left"===_.icon}])},{default:s((()=>[h(T,{class:"checklist-text",style:u(e.styleIconText)},{default:s((()=>[i(o(e[_.map.text]),1)])),_:2},1032,["style"]),"list"===_.mode&&"right"===_.icon?(a(),l(F,{key:0,style:u(e.styleRightIcon),class:"checkobx__list"},null,8,["style"])):m("",!0)])),_:2},1032,["class"])])),_:2},1032,["class","style"])))),128))])),_:1},8,["class","onChange"]))],64)):(a(),l(F,{key:0,class:"uni-data-loading"},{default:s((()=>[e.mixinDatacomErrorMessage?(a(),l(T,{key:1},{default:s((()=>[i(o(e.mixinDatacomErrorMessage),1)])),_:1})):(a(),l(L,{key:0,status:"loading",iconType:"snow",iconSize:18,"content-text":D.contentText},null,8,["content-text"]))])),_:1}))])),_:1},8,["style"])}],["__scopeId","data-v-4b96d17a"]]),R=w({__name:"index",setup(e){const o=k({name:"",idCard:"",gender:1,defaultFlag:0}),d=k(),r={name:{rules:[{required:!0,errorMessage:"请填写患者姓名"},{pattern:"^[一-龥]{2,5}$",errorMessage:"患者姓名为2-5个汉字"}]},idCard:{rules:[{required:!0,errorMessage:"请填写身份证号"},{pattern:"^[1-9]\\d{5}(18|19|([23]\\d))\\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\\d{3}[0-9Xx]$",errorMessage:"身份证号格式不正确"}]},gender:{rules:[{required:!0,errorMessage:"请选择性别"},{validateFunction:function(e,t,a,l){return a.idCard.slice(16,17)%2!==t&&l("身份证号与性别不匹配"),!0}}]}};function n(e){o.value.defaultFlag=e.detail.value?1:0}async function c(){try{const e=await d.value.validate();if(Object.keys(o.value).includes("id")){const e=await B(o.value);if(1e4!==e.code)return uni.utils.toast(e.message);C({delta:1})}else{const t=await M(e);if(1e4!==t.code)return uni.utils.toast(t.message);C({delta:1})}}catch(e){console.log(e)}}return T((e=>{e.id&&(_({title:"编辑患者"}),async function(e){const t=await E(e);if(1e4!==t.code)return uni.utils.toast(t.message);const{id:a,name:l,gender:s,defaultFlag:i,idCard:d}=t.data;o.value={id:a,name:l,gender:s,defaultFlag:i,idCard:d}}(e.id))})),(e,u)=>{const m=V(t("uni-easyinput"),L),f=V(t("uni-forms-item"),F),g=V(t("uni-data-checkbox"),N),y=D,b=p,v=S,x=V(t("uni-forms"),$),k=V(t("scroll-page"),j);return a(),l(k,null,{default:s((()=>[h(b,{class:"archive-page"},{default:s((()=>[h(x,{border:"",rules:r,model:o.value,"label-width":"220rpx",ref_key:"form",ref:d},{default:s((()=>[h(f,{label:"患者姓名",name:"name"},{default:s((()=>[h(m,{modelValue:o.value.name,"onUpdate:modelValue":u[0]||(u[0]=e=>o.value.name=e),"placeholder-style":"color: #C3C3C5; font-size: 32rpx",styles:{color:"#121826"},"input-border":!1,clearable:!1,placeholder:"请填写真实姓名"},null,8,["modelValue"])])),_:1}),h(f,{label:"患者身份证号",name:"idCard"},{default:s((()=>[h(m,{modelValue:o.value.idCard,"onUpdate:modelValue":u[1]||(u[1]=e=>o.value.idCard=e),"placeholder-style":"color: #C3C3C5; font-size: 32rpx",styles:{color:"#121826"},"input-border":!1,clearable:!1,placeholder:"请填写身份证号"},null,8,["modelValue"])])),_:1}),h(f,{label:"患者性别",name:"gender"},{default:s((()=>[h(g,{selectedColor:"#16C2A3",modelValue:o.value.gender,"onUpdate:modelValue":u[2]||(u[2]=e=>o.value.gender=e),localdata:[{text:"男",value:1},{text:"女",value:0}]},null,8,["modelValue"])])),_:1}),h(f,{label:"默认就诊人",name:"defaultFlag"},{default:s((()=>[h(b,{class:"uni-switch"},{default:s((()=>[h(y,{onChange:n,checked:1===o.value.defaultFlag,color:"#20c6b2",style:{transform:"scale(0.7)"}},null,8,["checked"])])),_:1})])),_:1}),h(v,{onClick:c,class:"uni-button"},{default:s((()=>[i("保存")])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})}}},[["__scopeId","data-v-3dcb0708"]]);export{R as default};

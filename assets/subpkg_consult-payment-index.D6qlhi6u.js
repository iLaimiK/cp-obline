import{o as t,a as e,w as a,d as i,G as s,r as n,n as l,e as o,t as u,z as r,i as c,h as d,q as p,m as f,b as m,f as _,F as y,Q as g,u as v,l as x}from"./index-SNMhby7L.js";import{a as h,b}from"./uni-list.0gdjOmcT.js";import{r as k}from"./uni-app.es.CqodLWiA.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as j}from"./scroll-page.D5HVTT5K.js";import{_ as S}from"./custom-payment.ClKNzDb9.js";import{p as w,c as F}from"./consult.CHO2TwaP.js";import{p as z}from"./patient.D4s0Fj-8.js";import{o as T}from"./payment.C9rbX7HI.js";import{u as D}from"./consult.BsD5jsFe.js";import"./uni-icons.GkTfaCN8.js";import"./uni-transition.fKTfgNeq.js";import"./http.CqkQg3YM.js";const I=C({name:"UniSection",emits:["click"],props:{type:{type:String,default:""},title:{type:String,required:!0,default:""},titleFontSize:{type:String,default:"14px"},titleColor:{type:String,default:"#333"},subTitle:{type:String,default:""},subTitleFontSize:{type:String,default:"12px"},subTitleColor:{type:String,default:"#999"},padding:{type:[Boolean,String],default:!1}},computed:{_padding(){return"string"==typeof this.padding?this.padding:this.padding?"10px":""}},watch:{title(t){uni.report&&""!==t&&uni.report("title",t)}},methods:{onClick(){this.$emit("click")}}},[["render",function(p,f,m,_,y,g){const v=c,x=d;return t(),e(v,{class:"uni-section"},{default:a((()=>[i(v,{class:"uni-section-header",onClick:g.onClick},{default:a((()=>[m.type?(t(),e(v,{key:0,class:s(["uni-section-header__decoration",m.type])},null,8,["class"])):n(p.$slots,"decoration",{key:1},void 0,!0),i(v,{class:"uni-section-header__content"},{default:a((()=>[i(x,{style:l({"font-size":m.titleFontSize,color:m.titleColor}),class:s(["uni-section__content-title",{distraction:!m.subTitle}])},{default:a((()=>[o(u(m.title),1)])),_:1},8,["style","class"]),m.subTitle?(t(),e(x,{key:0,style:l({"font-size":m.subTitleFontSize,color:m.subTitleColor}),class:"uni-section-header__content-sub"},{default:a((()=>[o(u(m.subTitle),1)])),_:1},8,["style"])):r("",!0)])),_:1}),i(v,{class:"uni-section-header__slot-right"},{default:a((()=>[n(p.$slots,"right",{},void 0,!0)])),_:3})])),_:3},8,["onClick"]),i(v,{class:"uni-section-content",style:l({padding:g._padding})},{default:a((()=>[n(p.$slots,"default",{},void 0,!0)])),_:3},8,["style"])])),_:3})}],["__scopeId","data-v-0a8818d5"]]),$=C({__name:"index",setup(s){const{type:n,patientId:l}=D().selectData,{illnessInfo:C,selectData:$}=D(),P=p(null),q=p({});const G=p({});const U=p("");function A(){!async function(){if(""!==U.value)return uni.utils.toast("订单已存在");C.pictures=C.pictures.map((({uuid:t,url:e})=>({id:t,url:e})));const t=await F({...$,...C});if(1e4!==t.code)return uni.utils.toast(t.message);U.value=t.data.id,D().clearData(),P.value.openPopup()}()}async function B(){const{confirm:t}=await g({title:"关闭支付",content:"取消支付将无法获得医生回复，医生接诊名额有限，是否确认关闭？",cancelText:"仍要关闭",cancelColor:"#848484",confirmText:"继续支付",confirmColor:"#16C2A3"});t||P.value.closePopup()}async function H(t){if(0===t.index)return uni.utils.toast("暂不支持微信支付！");const e=await T({paymentMethod:t.index,orderId:U.value,payCallback:"http://localhost:5173/#/subpkg_consult/room/index"});if(1e4!==e.code)return uni.utils.toast(e.message);window.location.href=e.data.payUrl}return f((()=>{!async function(){const t=await z(l);if(1e4!==t.code)return uni.utils.toast(t.message);G.value=t.data}(),async function(){const t=await w(n);if(1e4!==t.code)return uni.utils.toast(t.message);q.value=t.data}()})),(s,n)=>{const l=k(m("uni-list-item"),h),p=c,f=k(m("uni-list"),b),g=k(m("uni-section"),I),w=d,F=x,z=k(m("scroll-page"),j),T=k(m("custom-payment"),S);return t(),_(y,null,[i(z,null,{default:a((()=>[q.value.payment?(t(),e(p,{key:0,class:"payment-page"},{default:a((()=>[i(g,{"title-font-size":"32rpx","title-color":"#121826",padding:"30rpx",title:`图文问诊 ${q.value.payment.toFixed(2)}元`},{default:a((()=>[i(f,{border:!1},{default:a((()=>[i(l,{title:"极速问诊",note:"自动分配医生",thumb:"/static/uploads/doctor-avatar.jpg","thumb-size":"lg"}),i(l,{title:"优惠券","show-arrow":"","right-text":`-¥${q.value.couponDeduction.toFixed(2)}`},null,8,["right-text"]),i(l,{title:"积分抵扣"},{footer:a((()=>[i(p,{class:"uni-list-text-red"},{default:a((()=>[o("-¥"+u(q.value.pointDeduction.toFixed(2)),1)])),_:1})])),_:1}),i(l,{title:"实付款"},{footer:a((()=>[i(p,{class:"uni-list-text-red"},{default:a((()=>[o("¥"+u(q.value.actualPayment.toFixed(2)),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["title"]),i(p,{class:"dividing-line"}),i(g,{"title-font-size":"32rpx","title-color":"#121826",padding:"30rpx",title:"患者资料"},{default:a((()=>[i(f,{border:!1},{default:a((()=>[i(l,{title:"患者信息"},{footer:a((()=>[i(p,{class:"uni-list-text-gray"},{default:a((()=>[o(u(G.value.name)+" | "+u(G.value.genderValue)+" | "+u(G.value.age)+"岁 ",1)])),_:1})])),_:1}),i(l,{border:"",title:"病情描述",note:v(C).illnessDesc},null,8,["note"])])),_:1})])),_:1})])),_:1})):r("",!0),q.value.payment?(t(),e(p,{key:1,class:"next-step"},{default:a((()=>[i(p,{class:"total-amount"},{default:a((()=>[o(" 合计: "),i(w,{class:"number"},{default:a((()=>[o("¥"+u(q.value.actualPayment.toFixed(2)),1)])),_:1})])),_:1}),i(F,{onClick:A,class:"uni-button"},{default:a((()=>[o("立即支付")])),_:1})])),_:1})):r("",!0)])),_:1}),i(T,{orderId:U.value,amount:q.value.actualPayment,ref_key:"payment",ref:P,onClose:B,onConfirm:H},null,8,["orderId","amount"])],64)}}},[["__scopeId","data-v-31653933"]]);export{$ as default};

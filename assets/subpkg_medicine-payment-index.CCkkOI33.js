import{q as a,m as t,b as e,o as s,f as l,d as i,w as o,F as n,T as u,g as r,e as c,t as d,i as m,h as f,l as p,a as _,J as g,k as y}from"./index-nfqmuTx8.js";import{_ as v}from"./uni-icons.CVREZnA1.js";import{r as h}from"./uni-app.es.l2AdP1v2.js";import{a as x,b}from"./uni-list.D_TZQXpp.js";import{_ as j}from"./scroll-page.E3VajpOZ.js";import{_ as w}from"./custom-payment.BYzUlGd-.js";import{h as k}from"./http.BKV-_WDr.js";import{p as C,c as F}from"./medcine.DBs_hATX.js";import{o as P}from"./payment.DHTbypwa.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-transition.CV8Ul4sA.js";const q=$({__name:"index",props:{id:String},setup($){const q=$,D=a([]),T=a({}),I=a(""),z=a();async function A(){const a=await k.get("/patient/order/address");if(1e4!==a.code)return uni.utils.toast(a.message);D.value=a.data}async function H(){if(""!==I.value)return uni.utils.toast("订单已存在");const a=await F(q.id,D.value[0].id);if(console.log(a),1e4!==a.code)return uni.utils.toast(a.message);I.value=a.data.id,z.value.openPopup()}async function J(){const{confirm:a}=await u({title:"关闭支付",content:"确认取消支付？",cancelText:"关闭支付",cancelColor:"#848484",confirmText:"继续支付",confirmColor:"#16C2A3"});a||z.value.closePopup()}async function K(a){if(0===a.index)return uni.utils.toast("暂不支持微信支付！");const t=await P({paymentMethod:a.index,orderId:I.value,payCallback:"http://localhost:5173/#/subpkg_medicine/pay_result/index"});if(1e4!==t.code)return uni.utils.toast(t.message);window.location.href=t.data.payUrl}return t((()=>{!async function(){const a=await C(q.id);if(1e4!==a.code)return uni.utils.toast(a.message);T.value=a.data}(),A()})),(a,t)=>{const u=h(e("uni-icons"),v),k=m,C=f,F=y,P=h(e("uni-list-item"),x),$=h(e("uni-list"),b),q=p,I=h(e("scroll-page"),j),A=h(e("custom-payment"),w);return s(),l(n,null,[i(I,{"background-color":"#f6f6f6"},{default:o((()=>[i(k,{class:"medicine-page"},{default:o((()=>[i(k,{class:"page-header"},{default:o((()=>[(s(!0),l(n,null,r(D.value,((a,t)=>(s(),_(k,{class:"order-shippment",key:a.id},{default:o((()=>[i(k,{class:"region"},{default:o((()=>[i(u,{size:"16",color:"#FF7702",type:"location-filled"}),c(" "+d(a.city)+d(a.county),1)])),_:2},1024),i(k,{class:"detail"},{default:o((()=>[c(d(a.addressDetail),1)])),_:2},1024),i(k,{class:"receiver"},{default:o((()=>[c(d(a.receiver)+" "+d(a.mobile),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),i(k,{class:"order-shop"},{default:o((()=>[c(" 优医药房 "),i(C,{class:"alt"},{default:o((()=>[c("优医质保 假一赔十")])),_:1})])),_:1}),i(k,{class:"medicine-list"},{default:o((()=>[(s(!0),l(n,null,r(T.value.medicines,((a,t)=>(s(),_(k,{key:a.id,class:"medicine-list-item"},{default:o((()=>[i(F,{class:"medicine-cover",src:a.avatar,mode:"aspectFill"},null,8,["src"]),i(k,{class:"medicine-info"},{default:o((()=>[i(C,{class:"name"},{default:o((()=>[c(d(a.name),1)])),_:2},1024),i(C,{class:g([{symbol:1===a.prescriptionFlag},"unit"])},{default:o((()=>[c(d(a.specs),1)])),_:2},1032,["class"]),i(C,{class:"price"},{default:o((()=>[c("¥"+d(a.amount),1)])),_:2},1024)])),_:2},1024),i(k,{class:"quantity"},{default:o((()=>[c("x"+d(a.quantity),1)])),_:2},1024),i(k,{class:"guide"},{default:o((()=>[c("用法用量："+d(a.usageDosag),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),i(k,{class:"order-info"},{default:o((()=>[i($,{border:!1},{default:o((()=>[i(P,{title:"药品金额","right-text":`¥${T.value.payment}`},null,8,["right-text"]),i(P,{title:"运费","right-text":`¥${T.value.expressFee}`},null,8,["right-text"]),i(P,{title:"优惠券","show-arrow":"","right-text":`-¥${T.value.couponDeduction}`},null,8,["right-text"]),i(P,{title:"实付款","right-text":`¥${T.value.actualPayment}`},null,8,["right-text"])])),_:1})])),_:1}),i(k,{class:"toolbar"},{default:o((()=>[i(k,{class:"total-amount"},{default:o((()=>[c(" 需付款: "),i(C,{class:"number"},{default:o((()=>[c("¥"+d(T.value.actualPayment),1)])),_:1})])),_:1}),i(k,{class:"buttons"},{default:o((()=>[i(q,{onClick:H,class:"uni-button"},{default:o((()=>[c("立即支付")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),i(A,{onClose:J,onConfirm:K,"order-id":T.value.id,amount:T.value.actualPayment,ref_key:"payment",ref:z},null,8,["order-id","amount"])],64)}}},[["__scopeId","data-v-dd10a934"]]);export{q as default};
